# Детектор наличия каски на голове для системы безопасности на производстве

Вопрос безопасности на рабочих местах, особенно в строительстве, является крайне важным. Строительные каски — это один из основных элементов защиты, который может спасти жизнь или предотвратить серьезные травмы. Однако, несмотря на важность этого средства индивидуальной защиты, на практике бывает сложно контролировать, соблюдают ли рабочие правила безопасности.

Технологии компьютерного зрения помогают автоматизировать мониторинг, ускоряя процесс проверки и обеспечивая большую точность. Использование нейросетевых моделей для автоматического обнаружения касок на изображениях позволяет существенно повысить уровень безопасности, предотвратить аварии и снизить риски на строительных площадках.

Цель проекта — разработать систему, которая с помощью искусственного интеллекта будет эффективно обнаруживать наличие каски на головах людей, автоматически выявляя нарушения и обеспечивая оперативную реакцию на потенциальные угрозы.

-------------------------------------------------------------------------------------------------------

Для данного проекта использовалось два набора данных с изображениями людей в касках. Доступны по ссылкам:

https://www.kaggle.com/datasets/vodan37/yolo-helmethead

https://universe.roboflow.com/dinh-ho/safety2r-tbo4l-jyd5o

В наборе №1 присутствует 2 класса (0 - no-helmet, 1 - helmet), в наборе №2 - 5 классов (0 - helmet, 1 - no-helmet, 2 - safety vest, 3 - no-safety vest, 4 - shoes). Сначала необходимо привести их к одному виду путем отсечения во втором наборе лишних классов и заменой одного класса на другой. В итоге должно получится всего два класса (0 - no-helmet, 1 - helmet). Для этого использовался код из файлов reverse_labels.py и datasets_union.py.

Формат изображений: jpeg

Формат аннотаций: txt

При анализе объединенных датасетов было обнаружено, что большинство изображений не превышают размера 2000х2000px, а так же количество изображений суммарно составляет 43069 шт., из которых train 35084 шт. (81%), test 2496 шт. (6%), valid 5489 шт (13%).

![Figure_1](https://github.com/user-attachments/assets/934eaf84-c7f9-4dbb-8d84-e400a31eb721)

Для анализа датасетов использовался код из файла observe_dataset.py.

Далее анализировались объекты в датасетах. Всего обнаружено 122727 касок и 165119 голов без касок. В датасете большую часть занимают головы без касок (57%) по отношению к головам с касками (43%). Средняя площадь обнаруженных касок составляет 6632 пикселя. Для сравнения изображение размером 640х640 пикселей имеет площадь 409600 пикселей (каска занимает около 2% площади изображения). Для анализа использовался код из файла get_classes_info.py.

---------------------------------------------------------------------------------------------------------

# Выбор нейросетевой модели.
Я рассматривала 2 модели: YOLOv5 и YOLOv8.

Yolov5:

-Проверенная временем и хорошо оптимизированная модель.

-Более стабильные предсказания (особенно для небольших объектов).

-Лучше работает при ограниченных вычислительных ресурсах.

-Хороших результатов можно достичь с меньшим количеством эпох.


По скорости:

YOLOv5

GPU: 

Модель обычно работает очень быстро с помощью CUDA.

Инференс может достигать 30-50 FPS на современных графических процессорах (например, NVIDIA RTX 2080).


CPU: 

Модель может работать в режиме реального времени, но она менее эффективна по сравнению с GPU. Скорость на CPU обычно составляет 5-10 FPS на мощных процессорах Intel i7 или i9.




YOLOv8

GPU: 

Модель оптимизирована для более сложных вычислений и использует более глубокую архитектуру, но повышает точность, особенно на сложных изображениях.

CPU: 

YOLOv8 может быть заметно медленнее на CPU по сравнению с YOLOv5. Это связано с тем, что YOLOv8 использует более сложные сети и требует больше вычислительной мощности. Однако с более мощными процессорами, такими как AMD Ryzen 9 или Intel Xeon, можно ожидать 10-20 FPS.


--------------------------------------------------------------------------------------------------

Оценка моделей и результаты экспериментов:

![2025-02-23_23-11-29](https://github.com/user-attachments/assets/a3b73bf2-6ba1-46da-a823-f22a64b3c6b6)


![2025-02-23_23-16-13](https://github.com/user-attachments/assets/0d8a47f3-e891-4d9b-aafb-18f86d58c301)


![2025-02-23_23-15-52](https://github.com/user-attachments/assets/aa572a46-a57b-4044-b376-e6cf094511d3)



Наиболее оптимальным экспериментом является №10: YOLOv5, batch 16, img size 640, 50 epochs, aug. В этом случае получается хорошее значение mAP, и сама скорость инференса модели.

mAP 50 = 0.941

mAP 50-95 = 0.556

inference time (cpu) = 0.0406

inference time (gpu) = 0.0136

----------------------------------------------------------------------------------------------
Результаты обучения лучшей моедли:
12.757 training hours

P = 0.916

R = 0.882

mAP 50 = 0.941

mAP 50-95 = 0.556

CPU time = 0.0406 s

GPU time = 0.0136 s


![confusion_matrix](https://github.com/user-attachments/assets/4039f35f-3e72-4d08-94fa-93997739ff90)



Predicted no_helmet (0):

True no_helmet (0): 0.91 — модель правильно предсказала 91% объектов без каски

True helmet (1): 0 — модель не ошиблась, предсказав объекты с каской как no_helmet.

True background: 0.71 — 71% фоновых объектов ошибочно предсказаны как no_helmet.


Predicted helmet (1):

True no_helmet (0): 0 — модель не ошиблась, предсказав объекты без каски как helmet.

True helmet (1): 0.96 — модель правильно предсказала 96% объектов с каской.

True background: 0.29 — 29% фоновых объектов ошибочно предсказаны как helmet.


Predicted background:

True no_helmet (0): 0.08 — 8% объектов без каски ошибочно предсказаны как фон.

True helmet (1): 0.03 — 3% объектов с каской ошибочно предсказаны как фон.

True background: 0 — модель не предсказала ни одного фонового объекта как фон.




![results](https://github.com/user-attachments/assets/fd84ed26-009c-4221-9ff9-f782236624e2)

Линия mAP продолжает расти, необходимо будет в будущем проверить большее количество эпох.




![P_curve](https://github.com/user-attachments/assets/e39b30ec-5a77-4318-a259-c16a4e93fcc8)


Precision показывает, какая доля предсказанных моделью объектов действительно принадлежит этому классу. 
​
 
-Высокий precision означает, что модель редко ошибается, предсказывая объекты как принадлежащие классу (мало ложных срабатываний).


-Низкий precision может указывать на то, что модель слишком часто ошибочно классифицирует объекты.


![R_curve](https://github.com/user-attachments/assets/40770cce-fb55-40c4-a739-aa40e39388ef)


Recall показывает, какая доля объектов класса была правильно обнаружена моделью. 
​
 
-Высокий recall означает, что модель пропускает мало объектов (мало ложных отрицаний).


-Низкий recall указывает на то, что модель пропускает много объектов.


![PR_curve](https://github.com/user-attachments/assets/ad5dca67-0687-4953-8247-786fca804204)


Это график, который показывает баланс между точностью и полнотой при разных порогах уверенности модели. Чем больше площадь под кривой (AUC, Area Under Curve), тем лучше модель.

-Если кривая близка к верхнему правому углу, это означает, что модель одновременно имеет высокую точность и полноту.


-Если кривая близка к диагонали, это указывает на то, что модель работает почти случайно.



![F1_curve](https://github.com/user-attachments/assets/6f032a3a-e690-41e6-a38e-912e6f68d117)


-F1 полезен, когда важно учитывать как точность, так и полноту. Он особенно полезен, если классы несбалансированы.


-Высокий F1 указывает на хороший баланс между точностью и полнотой.


--------------------------------------------------------------------------------------------------

Дальнейшие исследования:

-Изучить более подробно процесс внедрения технологии,

-попробовать добавить больше изображений,

-другой размер модели (например, YOLOv5m, YOLOv5l)

-другую модель (например, YOLOv11),

-больше эпох с аугментацией (например, 70, 100 и т. д.),

-другой размер изображения (например, 1280 пикселей)


